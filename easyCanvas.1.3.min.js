/*
 *	EasyCanvas version 1.3
 *	Ken Fyrstenberg Nilsen, (c) 2013 Abidas Software
 *	http://easyCanvasJS.com/
 *	GPL-3.0 license (http://opensource.org/licenses/GPL-3.0)
*/
"use strict";function easyCanvas(){var al=this,aU,aa,M,ac=0,E,aw=0,ay=0,ax=0,av=0,aA=180/Math.PI,I=Math.PI/180,aV=1,aW=1,aF=0,aQ=0,aR=0,at=0,au=0,D,v=!0,aB=!1,aM,aP,aS,aT,A=!1,y,z,ar,ap,x=null,an=null,aq,aI,aG=0,aH=!1,af=!1,J=[".jpg",".jpeg",".png",".gif",".svg",".tif",".tiff",".bmp"],L=-1,K=-1,G=0,H=[0],aD=[],F=null,ab=[],Y=0,Z=0,W=0,X=0,P=!1,ao,az=["","webkit","moz","ms","o","khtml"],V=!0,ai=!0,ak=!1,aj,aO,ah=(typeof window.console.__mozillaConsole__!=="undefined"),ae=(typeof window.chrome!=="undefined"),o=25,b=aN();this.canvas=null;this.onmousedown=null;this.onmousemove=null;this.onmouseup=null;this.onredraw=null;this.onmousewheel=null;this.ondrop=null;this.ondropprogress=null;this.onselect=null;this.onselectend=null;this.onselectstart=null;this.reportResize=!0;this.calcAngle=!1;this.calcDistance=!1;this.calcVelocity=!1;this.autoResize=!1;this.trackMove=!1;this.clearColor=null;this.clearBeforeDraw=!0;this.autoClear=!1;this.selectionMode=!1;this.selectedRect=null;this.selectClearFull=!1;this.fullScreenMode=0;this.enableRegions=!1;this.crossOrigin=!1;this.crossOriginMode="anonymous";this.width;this.height;this.deltaX=0;this.deltaY=0;this.firstX=-1;this.firstY=-1;this.prevX=-1;this.prevY=-1;this.prevAngle=-1;this.prevStamp=null;this.count=0;this.pivotX=0.5;this.pivotY=0.5;this.panMode=!1;this.limitPan=!0;this.panCursor="move";this.record=!1;this.tool=0;this.strokes=[];this.strokeHeader=null;this.deg2rad=I;this.rad2deg=aA;this.total=0;this.isDown=!1;this.maxVel=0;this.oldCursor;this.isCursor=!1;if(arguments.length>0){for(;aO=arguments[ac];ac++){if(typeof aO==="number"){ai===!0?this.width=aU=parseInt(aO,10):this.height=aa=parseInt(aO,10);ai=!1}if(typeof aO==="string"){M=document.getElementById(aO);if(M instanceof HTMLCanvasElement){this.canvas=M;this.width=this.canvas.width;this.height=this.canvas.height}}if(aO instanceof HTMLCanvasElement){this.canvas=aO;this.width=this.canvas.width;this.height=this.canvas.height}if(aO instanceof HTMLElement){M=aO}}}this.resize=function(aY,aX){if(typeof aY!=="number"||typeof aX!=="number"){return g("Illegal numbers for width or height.","resize")}try{this.canvas.width=parseInt(aY,10)-(aw+ax);this.canvas.height=parseInt(aX,10)-(ay+av);this.canvas.style.marginLeft=aw+"px";this.canvas.style.marginTop=ay+"px";this.width=this.canvas.width;this.height=this.canvas.height;if(E!==undefined){C();aL();this.antialiasing(this.antialiasing())}aC();if(x!==null){x=al.getOffScreenCanvas()}}catch(i){return g("Error when resizing instance","resize")}return this};this.padding=function(aX,w,h,i){if(arguments.length===0){return[ay,ax,av,aw]}ay=aX;ax=w;av=h;aw=i;this.resize(this.canvas.width,this.canvas.height);return this};this.clear=function(){E.save();E.setTransform(1,0,0,1,0,0);if(this.clearColor===null){if(b===!0){this.canvas.width=this.canvas.width}else{E.clearRect(0,0,this.canvas.width,this.canvas.height)}}else{E.fillStyle=this.clearColor;E.fillRect(0,0,this.canvas.width,this.canvas.height)}E.restore();return this};this.remove=function(){try{var h=this.canvas;if(typeof M!=="undefined"&&M!==null&&typeof M!=="string"){if(af===!0){this.canvas.removeEventListener("dragover",e,!1);this.canvas.removeEventListener("drop",f,!1)}document.removeEventListener("fullscreenchange",j,!1);document.removeEventListener("mozfullscreenchange",j,!1);document.removeEventListener("webkitfullscreenchange",j,!1);window.removeEventListener("resize",t,!1);window.removeEventListener("mouseup",r,!1);this.canvas.removeEventListener(ah?"DOMMouseScroll":"mousewheel",s,!1);if(V===!0){window.removeEventListener("mousemove",q,!1)}h.onmousedown=null;h.onmousemove=null;h.onmouseup=null;h.onselectstart=null;h.onselect=null;h.onselectend=null;h.ondrop=null;h.ondropprogress=null;h.onmousewheel=null;if(!(M instanceof HTMLCanvasElement)){M.removeChild(h)}E=this.ctx=this.context=undefined;this.canvas=undefined}}catch(i){return g("Error removing instance","remove")}};this.style=function(i,h){if(arguments.length===1){return this.canvas.style[i]}this.canvas.style[i]=h;return this};this.cssClass=function(h){if(arguments.length===0){return this.canvas.className}if(h===null){h=""}this.canvas.className=h;return this};this.download=function(aX,aY,h){if(typeof aX!=="string"||aX.trim().length===0){aX="Untitled"}aY=(typeof aY==="string")?aY.toLowerCase():"png";if(aX.length<5||aX.substring(aX.length-aY.length)!==aY){aX+="."+aY}var aZ=document.createElement("a"),i=this.canvas,w;aZ.download=aX;if(aY==="png"){aZ.href=i.toDataURL()}else{if(aY==="jpg"||aY==="jpeg"){(typeof h==="number")?aZ.href=i.toDataURL("image/jpeg",h):aZ.href=i.toDataURL("image/jpeg")}}if(document.createEvent){w=document.createEvent("MouseEvents");w.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);aZ.dispatchEvent(w)}else{if(aZ.fireEvent){aZ.fireEvent("onclick")}}return this};this.clipCoords=function(i){if(typeof i!=="boolean"){return !V}var h=this.canvas;if(i!==V){return this}if(i===!0){window.removeEventListener("mousemove",q,!1);h.onmousemove=q}else{h.onmousemove=null;window.addEventListener("mousemove",q,!1)}V=!i;return this};this.zoom=function(aY,aZ,w,aX){if(aY===undefined){return[aV,aW]}if(typeof aZ!=="number"){aZ=aY}if(aY<0.0001){aY=0.0001}if(aZ<0.0001){aZ=0.0001}if(aV===aY&&aW===aZ){return this}if(typeof al.onbeforezoom==="function"){al.onbeforezoom({oldZoomX:aV,oldZoomY:aW,newZoomX:aY,newZoomY:aZ,timeStamp:T()})}var h=aV,i=aW;aV=aY;aW=aZ;aL();if(typeof al.onzoom==="function"){al.onzoom({oldZoomX:h,oldZoomY:i,newZoomX:aY,newZoomY:aZ,timeStamp:T()})}return this};this.rotate=function(h){if(arguments.length===0){return h}h=parseFloat(h);if(h===aF){return this}if(typeof al.onbeforerotate==="function"){al.onbeforerotate({oldAngle:aF,newAngle:h,timeStamp:T()})}while(h<0){h+=360}while(h>=360){h-=360}var i=aF;aF=h;aL();if(typeof al.onrotate==="function"){al.onrotate({oldAngle:i,newAngle:h,timeStamp:T()})}return this};this.pan=function(i,w,h){if(arguments.length===0){return[aQ,aR,at,au]}h=(typeof h==="boolean")?h:!1;if(typeof al.onbeforepan==="function"){al.onbeforepan({oldDeltaX:aQ,oldDeltaY:aR,newDeltaX:i,newDeltaY:w,isAbsolute:h,timeStamp:T()})}var aX=aQ,aY=aR;if(h===!0){aQ=i;aR=w}else{aQ+=i;aR+=w}aL();if(typeof al.onpan==="function"){al.onpan({oldDeltaX:aX,oldDeltaY:aY,newDeltaX:aQ,newDeltaY:aR,isAbsolute:h,timeStamp:T()})}return this};this.reset=function(){aV=aW=1;aF=aQ=aR=at=au=0;aL();return this};this.strokeLine=this.line=function(aX,aZ,aY,a0,w,h){var i=arguments.length;E.beginPath();E.moveTo(aX,aZ);E.lineTo(aY,a0);if(i>4){E.lineWidth=w}if(i>5){E.strokeStyle=h}E.stroke();return this};this.update=function(){aC()};this.grid=function(h,i,w,aX){switch(arguments.length){case 0:return[Y,Z,W,X];case 1:i=h;w=aX=0;break;case 2:w=aX=0;break;case 3:aX=w;break;case 4:break;case Default:return g("Unsupported number of arguments.","grid")}if(h<0){h=0}if(i<0){i=0}Y=h;Z=i;W=w;X=aX;return this};this.getGridX=function(h){if(Y===0){return h}if(h<W){h=W}return(((h+Y*0.5-W)/Y)|0)*Y+W};this.getGridY=function(h){if(Z===0){return h}if(h<X){h=X}return(((h+Z*0.5-X)/Z)|0)*Z+X};this.getGridSnapshot=function(w,i){if(Y===0&&Z===0){return null}var h=[],aX=[],aY=W,aZ=X;if(arguments.length===0){w=this.width;i=this.height}while(aZ<=i){aX.push([aY,aZ]);aY+=Y;if(aY>=w){h.push(aX);aX=[];aY=W;aZ+=Z}}return h};this.getGridCell=function(h,i){h=((h-W)/Y)|0;i=((i-X)/Z)|0;return[h,i]};this.getGridPosition=function(h,i){h=parseInt(h,10);i=parseInt(i,10);if(h<0){h=0}if(i<0){i=0}h=h*Y+W;i=i*Z+X;return[h,i]};this.lock=function(i){if(arguments.length===0){return A}if(i===A){return this}A=i;try{if(i===!0){ap=this.getPixel;ar=this.setPixel;this.getPixel=S;this.setPixel=aK;y=E.getImageData(0,0,this.canvas.width,this.canvas.height);z=y.data}else{this.getPixel=ap;this.setPixel=ar;E.putImageData(y,0,0)}}catch(h){return g(h.message||"Security error probably due to CORS restrictions","lock")}return this};function S(i,w){var h=y.width*w*4+i*4;return[z[h],z[h+1],z[h+2],z[h+3]]}function aK(w,aX,h){var i=y.width*aX*4+w*4;z[i]=h[0];z[i+1]=h[1];z[i+2]=h[2];if(h.length===4){z[i+3]=h[3]}return this}this.getPixel=function(w,aX){try{var i=E.getImageData(w,aX,1,1).data;return[i[0],i[1],i[2],i[3]]}catch(h){return g(h.message||"Security error probably due to CORS restrictions","getPixel")}};this.setPixel=function(aZ,a0,h){if(h.length===3){h.push(255)}var aX,i,aY;try{aX=E.getImageData(aZ,a0,1,1);i=aX.data;i[0]=h[0];i[1]=h[1];i[2]=h[2];i[3]=h[3];E.putImageData(aX,aZ,a0);return this}catch(w){aY=E.fillStyle;E.fillStyle="rgba("+h[0]+","+h[1]+","+h[2]+","+(h[3]/255).toFixed(2)+")";E.fillRect(aZ,a0,1,1);E.fillStyle=aY;return g(w.message||"Security error probably due to CORS restrictions.","setPixel")}};this.drawImageProp=function(a3,bb,bc,ba,a1,a7,a8){if(typeof a3==="undefined"||a3===null){return g("Image argument is null or undefined","drawImageProp")}if(arguments.length===1){bb=bc=0;ba=this.width;a1=this.height;a7=0.5;a8=0.5}a7=(typeof a7==="number")?a7:0.5;a8=(typeof a8==="number")?a8:0.5;if(a7<0){a7=0}if(a8<0){a8=0}if(a7>1){a7=1}if(a8>1){a8=1}var a4=a3.width,a2=a3.height,a9=Math.min(ba/a4,a1/a2),a6=a4*a9,a5=a2*a9,aZ,a0,aY,aX,i=1;if(a6<ba){i=ba/a6}if(a5<a1){i=a1/a5}a6*=i;a5*=i;aY=a4*1/(a6/ba);aX=a2*1/(a5/a1);aZ=(a4-aY)*a7;a0=(a2-aX)*a8;if(aZ<0){aZ=0}if(a0<0){a0=0}if(aY>a4){aY=a4}if(aX>a2){aX=a2}E.drawImage(a3,aZ,a0,aY,aX,bb,bc,ba,a1);return this};this.antialiasing=function(aZ){if(arguments.length===0){return v}v=aZ;var w=!1,aX,h=0,aY=";image-rendering:";for(;h<az.length;h++){aX=(h===0)?"imageSmoothingEnabled":az[h]+"ImageSmoothingEnabled";if(E[aX]!==undefined){E[aX]=v;w=!0;break}}if(w===!1){this.canvas.style.cssText=(v===!0)?aY+"-moz-auto"+aY+"-webkit-auto"+aY+"-o-auto"+aY+"auto;-ms-interpolation-mode:bicubic;":aY+"-moz-crisp-edges"+aY+"-webkit-optimize-contrast"+aY+"-o-crisp-edges"+aY+"crisp-edges;-ms-interpolation-mode:nearest-neighbor;"}return this};this.getOffscreenCanvas=this.getOffScreenCanvas=function(aZ,aX){var i=document.createElement("canvas"),aY,a0;if(arguments.length===0){aZ=this.canvas.width;aX=this.canvas.height}else{if(arguments.length===1&&typeof aZ!=="number"){if(typeof aZ.width==="undefined"&&typeof aZ.clientWidth==="undefined"){return g("Invalid arguments","getOffScreenCanvas")}aY=aZ;aZ=aY.width||aY.clientWidth;aX=aY.height||aY.clientHeight}}i.width=aZ;i.height=aX;a0=i.getContext("2d");if(typeof aY!=="undefined"){a0.drawImage(aY,0,0)}return{canvas:i,ctx:a0,context:a0,width:aZ,height:aX,centerX:aZ*0.5,centerY:aX*0.5}};this.loadImage=function(aX,h,i){if(typeof aX!=="string"){return g("An URL must be provided","loadImage")}if(typeof h!=="function"){return g("A callback function for loadImage success must be provided.","loadImage")}var w=document.createElement("img");w.onload=function(aY){h({image:this,url:aX,timeStamp:aY.timeStamp})};if(typeof i==="function"){w.onerror=function(aY){i({image:null,url:aX,timeStamp:T()})}}else{w.onerror=function(aY){g("Error loading image","loadImage")}}if(this.crossOrigin===!0){w.crossOrigin=this.crossOriginMode}w.src=aX;return this};this.loadImages=function(a3,h,a2){if(!Array.isArray(a3)||a3.length===0){return g("URL must be provided","loadImages")}if(typeof h!=="function"){return g("A callback function for loadImage success must be provided.","loadImages")}var aY=a3.length,a1=aY,a0=new Array(aY),aZ=0;if(typeof a2==="function"){a2({current:0,total:a1,image:null,timeStamp:T()})}for(;aZ<a1;aZ++){this.loadImage(a3[aZ],w,aX)}function w(i,a4){for(var a5=0;a5<a1;a5++){if(i.url===a3[a5]){break}}a0[a5]=(arguments.length===1)?i.image:null;aY--;if(typeof a2==="function"){a2({current:a1-aY,total:a1,image:a0[a5],timeStamp:i.timeStamp})}if(aY===0){h({images:a0,urls:a3,timeStamp:T()})}}function aX(i){w(i,1)}return this};this.getVelocity=function(aY){if(aS.length===0){return 0}if(aS.length===1){return aS[0]}aY=(typeof aY==="number")?parseInt(aY,10):3;if(aY>aS.length){aY=aS.count}var aX=0,aZ=0,h=0,w=1,a0;for(;aX<aY;aX++){aZ+=(aX+1)}aX=aS.length-aY;for(;a0=aS[aX];aX++){h+=aS[aX]*w/aZ;w++}return h};this.renderTool0=function(h,aY){E.beginPath();if(typeof aY==="number"){E.lineWidth=aY}if(typeof h==="string"){E.strokeStyle=h}var w=0,a1,a0,aX,aZ;for(;a0=this.strokes[w];w++){if(a0[0]===0){aX=a0.length;aZ=(aX*0.5===((aX*0.5)|0))?aZ=2:1;E.moveTo(a0[aZ],a0[aZ+1]);for(a1=aZ+2;a1<aX;a1+=2){E.lineTo(a0[a1],a0[a1+1])}}}E.stroke();return this};this.getRect=function(aX,aZ,aY,a0,w){w=(typeof w==="boolean")?w:!0;var h=aY-aX,i=a0-aZ;aX=(h<0)?aY:aX;aZ=(i<0)?a0:aZ;return(w===!0)?[aX,aZ,Math.abs(h)+1,Math.abs(i)+1]:[aX,aZ,Math.abs(h),Math.abs(i)]};this.startAutoClear=function(){if(typeof x==="undefined"||x===null){ad()}return this};this.updateAutoClear=function(){if(x!==null){x.ctx.drawImage(al.canvas,0,0)}return this};this.getAutoClearBuffer=function(){return x};this.clearBackground=function(aZ,a0,aY,aX){if(x!==null){if(aZ===null){return}if(arguments.length===0){aZ=a0=0;aY=al.width;aX=al.height}else{if(arguments.length===1){a0=aZ[1];aY=aZ[2];aX=aZ[3];aZ=aZ[0]}}aZ=parseInt(aZ,10);a0=parseInt(a0,10);aY=parseInt(aY,10);aX=parseInt(aX,10);aZ-=2;a0-=2;aY+=5;aX+=5;al.ctx.clearRect(aZ,a0,aY,aX);if(aZ<0){aZ=0}if(a0<0){a0=0}if(aZ>=al.width){aZ=al.width-1}if(a0>=al.height){a0=al.height-1}if(aY+aZ>al.width){aY=al.width-aZ}if(aX+a0>al.height){aX=al.height-a0}if(aY<1){aY=1}if(aX<1){aX=1}try{al.ctx.drawImage(x.canvas,aZ,a0,aY,aX,aZ,a0,aY,aX)}catch(i){return g(i.message||"Error occured","clearBackground")}}return this};this.endAutoClear=function(){if(x!==null){x=null}return this};this.setDash=function(w,i,h){if(arguments.length===0){return[H,G]}i=(typeof i==="number")?i:0;if(typeof w==="number"){w=[w,w]}if(w.length<2){w.push(w[0])}if(arguments.length<3){G=i;H=w}if(typeof E.setLineDash!=="undefined"){al.ctx.setLineDash(w);al.ctx.lineDashOffset=i}else{if(typeof E.mozDash!=="undefined"){al.ctx.mozDash=[5,5];al.ctx.mozDashOffset=i}}return this};this.drop=function(aX,w,i,h){if(typeof window.FileReader==="undefined"){return g("Sorry, FileReader is not supported in this browser","drop",1)}if(aX===!0&&af===!1){this.canvas.addEventListener("dragover",e,!1);this.canvas.addEventListener("drop",f,!1);af=!0}else{if(aX===!1&&af===!0){this.canvas.removeEventListener("dragover",e,!1);this.canvas.removeEventListener("drop",f,!1);af=!1}}L=(typeof w!=="undefined"&&w!==null)?w:L;K=(typeof i!=="undefined"&&i!==null)?i:K;J=(typeof h!=="undefined"&&Array.isArray(h))?h:J;return this};this.fullScreen=function(i){if((document.fullscreenenabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.oFullscreenEnabled||document.msFullscreenEnabled||(document.webkitCurrentFullScreenElement!==undefined))!==!0){return g("Fullscreen mode not supported in this browser","fullScreen",1)}if(arguments.length===0){return P}var h=al.canvas;if(i===!0&&!h.fullscreenElement&&!h.mozFullScreenElement&&!h.webkitFullscreenElement&&!h.oFullscreenElement&&!h.msFullscreenElement){h.requestFullScreen()}else{document.cancelFullScreen()}return this};function l(h){if(h===!0){ao={position:al.style("position"),x:al.style("left"),y:al.style("top"),w:al.width,h:al.height,cssW:al.style("width"),cssH:al.style("height")};al.style("position","fixed");al.style("left","0");al.style("top","0");switch(al.fullScreenMode){case 0:al.resize(screen.width,screen.height);break;case 1:al.style("width","100%");al.style("height","100%");break}}else{if(typeof ao!=="undefined"){al.style("position",ao.position);al.style("width",ao.cssW);al.style("height",ao.cssH);al.resize(ao.w,ao.h);al.style("left",ao.x);al.style("top",ao.y)}}if(typeof al.onfullscreen==="function"){al.onfullscreen({isFullscreen:h,timeStamp:T()})}}function j(h){h=h||window.event;var i=(document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.oFullScreenElement||document.msFullScreenElement||document.webkitCurrentFullScreenElement);P=(!(i===null||i===undefined));l(P)}this.addRegion=function(a0,a5,a6,a4,aY,a1,aX){var aZ=0,a3=T();if(arguments.length===1){a5=a0.x;a6=a0.y;a4=a0.width;aY=a0.height;a1=a0.pri;a0=a0.id;a3=a0.timeStamp;aX=a0.cursor}if(typeof a1==="undefined"){a1=0}if(typeof aX!=="string"){aX="default"}for(;aZ<aD.length;aZ++){if(aD[aZ][4]===a0){return g("A region with this ID already exist","addRegion")}}aD.push([a5,a6,a4+a5,aY+a6,a0,a1,a3,aX]);aD.sort(a2);function a2(h,i){if(h[5]===i[5]){return h[6]-i[6]}else{return h[5]-i[5]}}return this};this.updateRegion=function(aX,a0,a1,aZ,i,aY){if(arguments.length===1){al.removeRegion(aX.id);al.addRegion(aX)}else{al.removeRegion(aX);if(typeof aY==="undefined"){aY=0}al.addRegion(aX,a0,a1,aZ,i,aY)}return this};this.removeRegion=function(w){for(var h=0;h<aD.length;h++){if(aD[h][4]===w){aD.splice(h,1);return this}}return this};this.getRegion=function(w){for(var h=0;h<aD.length;h++){if(aD[h][4]===w){return aE(aD[h])}}return null};this.getRegions=function(){var h=0,w=[];for(;h<aD.length;h++){w.push(aE(aD[h]))}return w};this.testRegion=function(w,aX){var i=h(w,aX);if(i!==null){return aE(i)}else{return null}function h(a0,a1){for(var aY=0,aZ;aZ=aD[aY];aY++){if(a0>=aZ[0]&&a0<=aZ[2]&&a1>=aZ[1]&&a1<=aZ[3]){return aZ}}return null}};function aE(h){return{x:h[0],y:h[1],right:h[2],bottom:h[3],width:h[2]-h[0],height:h[3]-h[1],id:h[4],pri:h[5],timeStamp:h[6],cursor:h[7]}}this.textSelect=function(aY){var aZ=(aY===!0)?"text":"none",h=document.getElementsByTagName("body")[0],w=0,aX;for(;w<az.length;w++){aX=(w===0)?"userSelect":az[w]+"UserSelect";h.style[aX]=aZ}return this};this.addHotkey=function(aX,h,i,w){if(al.hasHotkey(aX,h,i,w)===!0){return g("Hotkey already defined","addHotkey")}var aY=p(aX);if(aY===null){return g("Invalid key","addHotkey")}if(typeof w!=="boolean"){w=!1}if(typeof i!=="boolean"){i=!1}if(typeof h!=="boolean"){h=!1}ab.push([aX,aY,h,i,w]);if(ab.length===1){window.addEventListener("keyup",m,!1)}return this};this.hasHotkey=function(a1,aY,aZ,a0){var a2=p(a1),aX=0,w;if(a2===null){return g("Invalid key","addHotkey")}if(typeof a0!=="boolean"){a0=!1}if(typeof aZ!=="boolean"){aZ=!1}if(typeof aY!=="boolean"){aY=!1}for(;w=ab[aX];aX++){if(a2===w[1]&&aY===w[2]&&aZ===w[3]&&a0===w[4]){return !0}}return !1};this.removeHotkey=function(a1,aY,aZ,a0){var a2=p(a1),aX=0,w;if(a2===null){return g("Invalid key","addHotkey")}if(typeof a0!=="boolean"){a0=!1}if(typeof aZ!=="boolean"){aZ=!1}if(typeof aY!=="boolean"){aY=!1}for(;w=ab[aX];aX++){if(a2===w[1]&&aY===w[2]&&aZ===w[3]&&a0===w[4]){ab.splice(aX,1);if(ab.length===0){window.removeEventListener("keyup",m,!1)}return this}}return g("Hotkey not found","removeHotkey")};this.getRegionsInArea=function(a3,a4,a2,aY){if(arguments.length===1){a4=a3.y;a2=a3.width;aY=a3.height;a3=a3.x}var aZ=0,a1,a0=[],a5=a3+a2,aX=a4+aY;a5++;a3--;aX++;a4--;for(;a1=aD[aZ];aZ++){if((a1[0]>a5||a1[2]<a3||a1[1]>aX||a1[3]<a4)===!1){a0.push(aE(a1))}}return a0};function p(w){var aX=null,i={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},aZ={pgup:33,pageup:33,pgdown:34,pagedown:34,left:37,up:38,right:39,down:40,end:35,home:36,tab:9,enter:13},aY={esc:27,insert:45,del:46,"delete":46,capslock:20,winleft:91,winright:92,numlock:144,scrolllock:145,backspc:8,backspace:8,pause:19,"break":19},a0={" ":32,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57},h={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90};if(typeof w==="string"){if(w.length===1){if(aX===null&&a0[w]){aX=a0[w]}if(aX===null&&h[w]){aX=h[w]}}else{if(aX===null&&i[w]){aX=i[w]}if(aX===null&&aZ[w]){aX=aZ[w]}if(aX===null&&aY[w]){aX=aY[w]}}}else{if(typeof w==="number"){aX=parseInt(w,10)}}return aX}function m(w){if(typeof al.onhotkey!=="function"){return}w=w||window.event;var aZ=w.charCode||w.keyCode,aY=0,aX;for(;aX=ab[aY];aY++){if(aZ===aX[1]&&w.altKey===aX[2]&&w.ctrlKey===aX[3]&&w.shiftKey===aX[4]){if(w.preventDefault){w.preventDefault()}w.returnValue=!1;al.onhotkey({key:aX[0],keyCode:aX[1],isAlt:aX[2],isCtrl:aX[3],isShift:aX[4],timeStamp:w.timeStamp});return !1}}}this.cancelSelection=function(){if(al.isDown===!0&&al.selectionMode===!0){N(!0,null);al.isDown=!1;return}};this.ge=function(h){return document.querySelector(h)||document.getElementById(h)};function e(h){h=h||window.event;h.stopPropagation();h.preventDefault();h.dataTransfer.effectAllowed="copy";h.dataTransfer.dropEffect="copy"}function f(aY){aY=aY||window.event;aY.stopPropagation();aY.preventDefault();if(typeof al.ondrop!=="function"){return !1}var a2=aY.target.files||aY.dataTransfer.files,a0,a3,a4,a5,w=a2.length,a9=new Array(w),a1=new Array(w),aZ=[],bc=[],aX=!0,a6=0,ba,bb=1;for(;a6<w;a6++){a9[a6]=null}if(typeof al.ondropstart==="function"){al.ondropstart({total:a2.length,timeStamp:T()})}for(a6=0;a0=a2[a6];a6++){a3=a0.name;a4=a0.size;a5=a0.type;if(a5.indexOf("image")===0&&ag(a3)===!0&&(L<0||a4<=L)&&(K<0||a6<K)){bc.push(new FileReader());ba=bc.length-1;bc[ba].___i=a6;bc[ba].___p=bb;bc[ba].___fn=a3;bc[ba].onload=h;bc[ba].readAsDataURL(a0)}else{aZ.push({filename:a3,length:a4,index:a6,maxSize:L,maxItems:K});a1[a6]=a3;w--;d(aX,bb,a2.length,null,a3);bb++;aX=!1;if(w===0){aX=!1;c(a9,a1,aZ)}}}function h(i){var bd=document.createElement("img");bd.onload=a8;bd.onerror=a7;bd.___i=this.___i;bd.___fn=this.___fn;bd.src=i.target.result}function a8(i){var be=this.___i,bd=this.___fn;d(aX,bb,a2.length,this,bd);bb++;a9[be]=this;a1[be]=bd;w--;if(w===0){aX=!1;c(a9,a1,aZ)}}function a7(i){d(aX,bb,a2.length,null,this.___fn);bb++;a1[this.___i]=this.___fn;w--;aZ.push({filename:this.___fn,length:0,index:this.___i,maxSize:L,maxItems:K});if(w===0){aX=!1;c(a9,a1,aZ)}}return !1}function ag(w){var h=k(w).toLowerCase(),aX=0,aY;for(;aY=J[aX];aX++){if(aY.toLowerCase()===h){return !0}}return !1}function k(h){var w=h.length-1;while(w--){if(h.charAt(w)==="."){return h.substring(w)}}return""}function d(i,h,aZ,aY,aX){if(i===!0&&typeof al.ondropprogress==="function"){var w={current:h,total:aZ,image:aY,filename:aX,timeStamp:T()};al.ondropprogress(w)}}function c(aX,w,i){var h={images:aX,filenames:w,errors:i,total:aX.length,count:aX.length-i.length,timeStamp:T()};al.ondrop(h)}function aC(){if(typeof al.onredraw==="function"){if(al.clearBeforeDraw===!0){al.clear()}al.onredraw(!1)}}function Q(i,aX,w,aY){var h=Math.atan2(aY-aX,w-i)*aA;if(h<0){h+=360}return h}function R(h,aX,i,aY){var w=i-h,aZ=aY-aX;return Math.sqrt(w*w+aZ*aZ)}function U(aX,w,h){var i=w-aX;if(i<=0){return 0}return h/i}function C(){var w=getComputedStyle(al.canvas),aX,aY,h,i;aX=parseInt(w.getPropertyValue("padding-left"),10);if(isNaN(aX)===!0){aX=0}h=parseInt(w.getPropertyValue("border-left-width"),10);if(isNaN(h)===!0){h=0}aY=parseInt(w.getPropertyValue("padding-top"),10);if(isNaN(aY)===!0){aY=0}i=parseInt(w.getPropertyValue("border-top-width"),10);if(isNaN(i)===!0){i=0}al.deltaX=aX+h;al.deltaY=aY+i}function B(a0,a1){var i,w,h,aX,aY,aZ;D=al.canvas.getBoundingClientRect();aY=a0-D.left-al.deltaX;aZ=a1-D.top-al.deltaY;a0=aY/aV;a1=aZ/aW;if(Y>0){if(a0<W){a0=W}a0=(((a0+Y*0.5-W)/Y)|0)*Y+W}if(Z>0){if(a1<X){a1=X}a1=(((a1+Z*0.5-X)/Z)|0)*Z+X}if(aF!==0){i=al.width*al.pivotX/aV;w=al.height*al.pivotY/aW;h=(Q(i,w,a0,a1)-aF)*I;aX=R(i,w,a0,a1);a0=i+aX*Math.cos(h);a1=w+aX*Math.sin(h)}return[a0-at,a1-au,aY,aZ]}function aL(){var a1=al.width,aY=al.height,a0=a1*al.pivotX,aZ=aY*al.pivotY,a3,a2,aX,i;al.ctx.setTransform(1,0,0,1,0,0);al.ctx.translate(a0,aZ);if(aF!==0){al.ctx.rotate(aF*I)}al.ctx.scale(aV,aW);al.ctx.translate(-a0,-aZ);at=((al.width-al.width*aV)*al.pivotX)/aV;au=((al.height-al.height*aW)*al.pivotY)/aW;if(al.limitPan===!0){a3=a1/aV;a2=aY/aW;if(aV>=1){aX=a1-a3+at;if(aQ<-aX){aQ=-aX}if(aQ>-at){aQ=-at}}else{aX=a3-a1-at;if(aQ<-at){aQ=-at}if(aQ>aX){aQ=aX}}if(aW>=1){i=aY-a2+au;if(aR<-i){aR=-i}if(aR>-au){aR=-au}}else{i=a2-aY-au;if(aR<-au){aR=-au}if(aR>i){aR=i}}}al.ctx.translate(aQ,aR);aC()}function aJ(){if(al.panMode===!0){if(al.isCursor===!1&&typeof al.panCursor==="string"){al.oldCursor=al.canvas.style.cursor;al.canvas.style.cursor=al.panCursor;al.isCursor=!0}}else{if(al.isCursor===!0){al.canvas.style.cursor=al.oldCursor;al.isCursor=!1}}}function ad(){if(x!==null){return}try{x=al.getOffScreenCanvas(al.canvas);an=null}catch(h){return g("Could not allocate buffer for autoClear.","initAutoClear")}}function N(h,i){clearInterval(aI);if(al.selectClearFull===!1){al.clearBackground(aq)}else{al.clearBackground()}if(al.autoClear===!1){al.endAutoClear()}al.selectedRect=(h===!1)?aq:null;al.setDash(0);if(typeof al.onselectend==="function"){al.onselectend({x:aq[0],y:aq[1],width:aq[2],height:aq[3],mouseX:aq[0]+aq[2],mouseY:aq[1]+aq[3],selfDraw:!1,cancelSelection:!1,timeStamp:T(),originalEvent:i,selectionCancelled:h})}}function u(){if(aq!==null){al.setDash(0,0,!0);al.ctx.strokeStyle="#000";al.ctx.strokeRect(aq[0]+0.5,aq[1]+0.5,aq[2],aq[3]);al.setDash(5,aG++,!0);al.ctx.strokeStyle="#fff";al.ctx.strokeRect(aq[0]+0.5,aq[1]+0.5,aq[2],aq[3])}}function T(){return(new Date()).getTime()}try{if(this.canvas===null){this.canvas=document.createElement("canvas");this.canvas.innerHTML="easyCanvas";if(typeof this.canvas==="undefined"){return g("Could not create a canvas element.","INIT")}if(typeof aU!=="number"||typeof aa!=="number"){this.canvas.style.position="fixed";this.canvas.style.left="0";this.canvas.style.top="0";this.resize(window.innerWidth,window.innerHeight);this.autoResize=!0}else{this.canvas.width=this.width;this.canvas.height=this.height}}else{M=null}C();E=this.ctx=this.context=this.canvas.getContext("2d");if(typeof E==="undefined"){return g("Could not create a 2D canvas context.","INIT")}if(M!==null){if(typeof M==="undefined"){M=document.getElementsByTagName("body")[0]}if(typeof M==="undefined"){return g("No element is defined (body seem unavailable)","INIT")}M.appendChild(this.canvas)}}catch(O){return g("Error duing initialization of instance","INIT")}window.addEventListener("resize",t,!1);window.addEventListener("mouseup",r,!1);window.addEventListener("mousemove",q,!1);document.addEventListener("fullscreenchange",j,!1);document.addEventListener("mozfullscreenchange",j,!1);document.addEventListener("webkitfullscreenchange",j,!1);this.canvas.addEventListener(ah?"DOMMouseScroll":"mousewheel",s,!1);function t(h){h=h||window.event;if(al.reportResize===!0){if(al.autoResize===!0){al.resize(window.innerWidth,window.innerHeight)}else{aC()}}}this.canvas.onmousedown=function(i){i=i||window.event;if(!("which" in i?i.which===1:i.button===1)){return}var h=B(i.clientX,i.clientY),w=h[0],aX=h[1];al.firstX=al.prevX=w;al.firstY=al.prevY=aX;al.isDown=!0;if(al.selectionMode===!0){al.selectedRect=aq=null;(al.autoClear===!0)?al.updateAutoClear():ad();aG=0;if(typeof al.onselectstart==="function"){al.onselectstart({x:w,y:aX,mouseX:w,mouseY:aX,timeStamp:T(),originalEvent:i})}aI=setInterval(u,32);return}if(al.panMode===!1){w-=aQ;aX-=aR}al.prevStamp=i.timeStamp;al.prevAngle=0;al.total=0;al.maxVel=0;al.count=1;aS=[];aB=al.record;aP=al.tool;if(al.autoClear===!0){ad()}if(aB===!0){aM=[al.tool];aM.push(w);aM.push(aX)}if(al.enableRegions===!0){F=al.testRegion(w,aX);if(F!==null&&typeof al.onregiondown==="function"){al.onregiondown({region:F,timeStamp:i.timeStamp,x:w,y:aX})}}if(typeof al.onmousedown==="function"){al.onmousedown({x:w,y:aX,relativeX:h[2],relativeY:h[3],timeStamp:i.timeStamp,originalEvent:i})}aj=(typeof al.onmousemove==="function")};function q(aZ){aZ=aZ||window.event;if(aZ.preventDefault){aZ.preventDefault()}var a1=al,a0,w=!0,a4,h,aX,aY,i,a5,a6,a2,a3;if(ak===!1){aJ()}if(a1.isDown===!0||a1.trackMove===!0){i=B(aZ.clientX,aZ.clientY);a5=i[0];a6=i[1];aX=aY=0;if(al.selectionMode===!0){a5=parseInt(a5,10);a6=parseInt(a6,10);if(aq!==null){if(aH===!0){if(al.selectClearFull===!1){al.clearBackground(aq)}else{al.clearBackground()}}else{if(al.selectClearFull===!1){al.clearBackground(aq[0],aq[1],aq[2],1);al.clearBackground(aq[0],aq[1],1,aq[3]);al.clearBackground(aq[0]+aq[2],aq[1],1,aq[3]);al.clearBackground(aq[0],aq[1]+aq[3],aq[2],1)}else{al.clearBackground()}}}al.prevX=a5;al.prevY=a6;aq=al.getRect(parseInt(al.firstX,10),parseInt(al.firstY,10),parseInt(a5,10),parseInt(a6,10),!1);if(typeof al.onselect==="function"){a0={x:aq[0],y:aq[1],width:aq[2],height:aq[3],mouseX:a5,mouseY:a6,selfDraw:!1,cancelSelection:!1,timeStamp:T(),originalEvent:aZ};al.onselect(a0);aH=a0.selfDraw;if(a0.cancelSelection===!0){N(!0,aZ);al.isDown=!1;return}}if(aH===!1){al.setDash(0,0,!0);al.ctx.strokeStyle="#000";al.ctx.strokeRect(aq[0]+0.5,aq[1]+0.5,aq[2],aq[3]);al.setDash(5,aG++,!0);al.ctx.strokeStyle="#fff";al.ctx.strokeRect(aq[0]+0.5,aq[1]+0.5,aq[2],aq[3])}else{clearInterval(aI)}return}if(a1.panMode===!1){a1.count++;a0={x:a5-aQ,y:a6-aR,relativeX:i[2],relativeY:i[3],timeStamp:aZ.timeStamp,originalEvent:aZ,isMouseDown:a1.isDown,count:a1.count};if(a1.calcAngle===!0){h=Q(a1.prevX,a1.prevY,a5,a6);a0.angle=h;a0.relativeAngle=180-Math.abs(Math.abs(a1.prevAngle-h)-180);a0.firstAngle=Q(a1.firstX,a1.firstY,a5,a6);a1.prevAngle=h}if(a1.calcDistance===!0||a1.calcVelocity===!0){a0.distance=R(a1.prevX,a1.prevY,a5,a6);a0.firstDistance=R(a1.firstX,a1.firstY,a5,a6);a0.totalDistance=(a1.total+=a0.distance)}if(a1.calcVelocity===!0){clearTimeout(aT);a4=U(a1.prevStamp,a0.timeStamp,a0.distance);a0.velocity=a4;if(a4>a1.maxVel){a1.maxVel=a4}aS.push(a4);aT=setTimeout(function(){aS=[]},52)}a5-=aQ;a6-=aR;if(a1.autoClear===!0){if(a1.trackMove===!0&&x===null){ad()}if(an!==null){al.clearBackground(an)}an=a1.getRect(a1.firstX,a1.firstY,a5,a6,!1)}if(aB===!0&&a1.isDown===!0&&aP!==1){aM.push(a5);aM.push(a6)}if(aj===!0||typeof al.onmousemove==="function"){a1.onmousemove(a0)}}else{aX=a5-a1.prevX;aY=a6-a1.prevY;if(typeof al.onbeforepan==="function"){al.onbeforepan({oldDeltaX:aQ,oldDeltaY:aR,newDeltaX:(aQ+aX),newDeltaY:(aR+aY),isAbsolute:!1,timeStamp:T()})}a2=aQ;a3=aR;aQ+=aX;aR+=aY;aL();if(typeof al.onpan==="function"){al.onpan({oldDeltaX:a2,oldDeltaY:a3,newDeltaX:aQ,newDeltaY:aR,isAbsolute:!1,timeStamp:T()})}}a1.prevStamp=aZ.timeStamp;a1.prevX=a5;a1.prevY=a6}else{if(a1.enableRegions===!0&&typeof a1.onregionover==="function"&&al.selectionMode===!1){i=B(aZ.clientX,aZ.clientY);a5=i[0];a6=i[1];if(F!==null&&a5>=F.x&&a5<=F.right&&a6>=F.y&&a6<=F.bottom){return}F=al.testRegion(a5,a6);al.style("cursor","default");if(F!==null){al.style("cursor",F.cursor);al.onregionover({region:F,timeStamp:aZ.timeStamp,x:a5,y:a6})}}}return !1}function r(i){i=i||window.event;if(i.preventDefault){i.preventDefault()}var h=B(i.clientX,i.clientY),aY=h[0],aZ=h[1],aX,w;if(al.isDown===!0){al.isDown=!1;if(al.selectionMode===!0){N(!1,i);return}w={x:aY-aQ,y:aZ-aR,count:al.count,relativeX:h[2],relativeY:h[3],timeStamp:i.timeStamp,originalEvent:i};if(al.calcAngle===!0){w.lastAngle=al.prevAngle;w.totalAngle=w.firstAngle=Q(al.firstX,al.firstY,aY,aZ)}if(al.calcDistance===!0){w.totalDistance=al.total;w.firstDistance=R(al.firstX,al.firstY,aY,aZ)}if(al.calcVelocity===!0){clearTimeout(aT);w.maxVelocity=al.maxVel}if(al.panMode===!1){aY-=aQ;aZ-=aR}if(al.autoClear===!0){x=null}if(aB===!0){if(al.strokeHeader!==null){aM.splice(1,0,al.strokeHeader)}al.strokes.push(aM)}if(al.enableRegions===!0&&typeof al.onregion==="function"){aX=al.testRegion(aY,aZ);if(F!==null&&aX!==null&&F.id===aX.id){al.onregion({region:F,timeStamp:i.timeStamp,x:aY,y:aZ})}}if(typeof al.onmouseup==="function"){al.onmouseup(w)}}}function s(i){if(typeof al.onmousewheel==="function"){i=i||window.event;var h=B(i.clientX,i.clientY),w=h[0],aX=h[1];al.onmousewheel({x:w-aQ,y:aX-aR,relativeX:h[2],relativeY:h[3],delta:parseInt((i.detail?i.detail*-40:i.wheelDelta)/120,10),timeStamp:i.timeStamp,originalEvent:i});if(typeof i.preventDefault==="undefined"){return !1}else{i.preventDefault()}}}function aN(){if(window.chrome){var i=document.createElement("canvas"),w=i.getContext("2d"),h;i.width=32;i.height=1;w.fillRect(0,0,32,1);i.width=8;h=w.getImageData(0,0,1,1).data;return(h[3]===0)}return !1}function g(i,w){if(arguments.length===3){alert('Error calling "'+w+'": '+i)}if(typeof al.onerror==="function"){var h={};h.message=i;h.source=w;h.timeStamp=T();al.onerror(h)}else{throw'Error calling "'+w+'": '+i}return !1}function am(h){h.forEach(a)}function a(h){switch(h.name){case"limitPan":aL();return;case"panMode":aJ();return}}function n(){if(al.onredraw===null){o--;if(o>0){setTimeout(n,10)}}else{al.clear();al.onredraw(!1)}}n();if(Object.observe!==undefined){Object.observe(this,am);ak=!0}return this}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,15)};HTMLCanvasElement.prototype.requestFullScreen=HTMLCanvasElement.prototype.requestFullScreen||HTMLCanvasElement.prototype.webkitRequestFullScreen||HTMLCanvasElement.prototype.webkitRequestFullscreen||HTMLCanvasElement.prototype.mozRequestFullScreen||HTMLCanvasElement.prototype.oRequestFullScreen||HTMLCanvasElement.prototype.msRequestFullScreen;document.cancelFullScreen=document.cancelFullScreen||document.webkitCancelFullScreen||document.webkitCancelFullscreen||document.mozCancelFullScreen||document.oCancelFullScreen||document.msCancelFullScreen;